generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    Int                 @id @default(autoincrement())
  email                 String              @unique
  password              String
  name                  String
  role                  UserRole            @default(USER)
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  createdLineItems      BookingLineItem[]
  sentInvitations       CarrierInvitation[]
  systemSettingsUpdates SystemSettings[]

  // Dispatch module relations
  createdTrips       LinehaulTrip[] @relation("TripCreator")
  dispatchedTrips    LinehaulTrip[] @relation("TripDispatcher")
  reportedDelays     TripDelay[]
  closedPayPeriods   PayPeriod[]    @relation("PayPeriodCloser")
  exportedPayPeriods PayPeriod[]    @relation("PayPeriodExporter")
  reviewedTripPays      TripPay[]             @relation("TripPayReviewer")
  approvedTripPays      TripPay[]             @relation("TripPayApprover")
  createdLateReasons    LateDepartureReason[]

  // Driver trip report relations
  verifiedReports       DriverTripReport[]    @relation("ReportVerifier")
  approvedReports       DriverTripReport[]    @relation("PayApprover")
  resolvedIssues        EquipmentIssue[]      @relation("IssueResolver")

  // Cut pay relations
  approvedCutPayRequests CutPayRequest[]      @relation("CutPayApprover")

  // Payroll line item relations
  reviewedPayrollLineItems  PayrollLineItem[] @relation("PayrollLineItemReviewer")
  approvedPayrollLineItems  PayrollLineItem[] @relation("PayrollLineItemApprover")

  @@map("users")
}

model Carrier {
  id                         Int                     @id @default(autoincrement())
  name                       String
  contactPerson              String?
  phone                      String?
  email                      String?
  mcNumber                   String?                 @unique
  dotNumber                  String?                 @unique
  insuranceExpiration        DateTime?
  status                     CarrierStatus           @default(PENDING)
  rating                     Decimal?                @db.Decimal(2, 1)
  ratePerMile                Decimal?                @db.Decimal(5, 2)
  onboardingComplete         Boolean                 @default(false)
  createdAt                  DateTime                @default(now())
  updatedAt                  DateTime                @updatedAt
  carrierType                String?
  city                       String?
  factoringCompany           String?
  remittanceContact          String?
  remittanceEmail            String?
  safetyRating               String?
  state                      String?
  streetAddress1             String?
  streetAddress2             String?
  taxId                      String?
  zipCode                    String?
  dbaName                    String?
  emergencyPhone             String?
  fleetSize                  Int?
  mcpAuthorityStatus         String?
  mcpInsuranceExpiration     DateTime?
  mcpLastSync                DateTime?
  mcpMonitored               Boolean                 @default(false)
  mcpPacketCompleted         Boolean                 @default(false)
  mcpPacketCompletedAt       DateTime?
  mcpRiskScore               Int?
  mcpSafetyRating            String?
  scacCode                   String?
  totalPowerUnits            Int?
  isCommonCarrier            Boolean                 @default(false)
  isContractCarrier          Boolean                 @default(false)
  isBroker                   Boolean                 @default(false)
  truckCount                 Int                     @default(0)
  trailerCount               Int                     @default(0)
  driverCount                Int                     @default(0)
  mcpInsuranceStatus         String?
  mcpOperationsStatus        String?
  mcpSafetyStatus            String?
  mcpPacketStatus            String?
  mcpTotalPoints             Int                     @default(0)
  generalLiabilityExpiration DateTime?
  generalLiabilityCoverage   Decimal?                @db.Decimal(12, 2)
  cargoLiabilityExpiration   DateTime?
  cargoLiabilityCoverage     Decimal?                @db.Decimal(12, 2)
  autoLiabilityExpiration    DateTime?
  autoLiabilityCoverage      Decimal?                @db.Decimal(12, 2)
  bookings                   Booking[]
  agreements                 CarrierAgreement[]
  documents                  CarrierDocument[]
  drivers                    CarrierDriver[]
  preferredRoutes            CarrierPreferredRoute[]

  @@map("carriers")
}

model Route {
  id                   Int                     @id @default(autoincrement())
  name                 String
  origin               String
  destination          String
  distance             Decimal                 @db.Decimal(6, 1)
  standardRate         Decimal?                @db.Decimal(5, 2)
  frequency            String?
  departureTime        String?
  arrivalTime          String?
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  active               Boolean                 @default(true)
  destinationAddress   String?
  destinationCity      String?
  destinationContact   String?
  destinationState     String?
  destinationZipCode   String?
  originAddress        String?
  originCity           String?
  originContact        String?
  originState          String?
  originZipCode        String?
  runTime              Int?
  destinationLatitude  Decimal?                @db.Decimal(10, 7)
  destinationLongitude Decimal?                @db.Decimal(10, 7)
  destinationTimeZone  String?
  originLatitude       Decimal?                @db.Decimal(10, 7)
  originLongitude      Decimal?                @db.Decimal(10, 7)
  originTimeZone       String?

  // Multi-leg profile support
  legOrder             Int?                    // Sequence number for multi-leg routes (1, 2, 3, etc.)
  dayOffset            Int?                    @default(0) // Day offset from initial dispatch (0=same day, 1=next day, etc.)
  isMultiLeg           Boolean                 @default(false) // True if this route is part of a multi-leg profile

  // Relations
  bookings             Booking[]
  preferredBy          CarrierPreferredRoute[]
  loadsheets           Loadsheet[]

  @@index([name])
  @@index([name, legOrder])
  @@map("routes")
}

model SystemSettings {
  id                      Int      @id @default(autoincrement())
  fuelSurchargeRate       Decimal  @default(0.00) @db.Decimal(5, 2)
  fuelSurchargeSource     String   @default("manual") // "manual" or "external"
  fuelSurchargeExternalId String?  // External source identifier/reference
  updatedAt               DateTime @updatedAt
  updatedBy               Int?
  updatedByUser           User?    @relation(fields: [updatedBy], references: [id])

  @@map("system_settings")
}

model Booking {
  id                           Int               @id @default(autoincrement())
  carrierId                    Int?
  routeId                      Int?
  bookingDate                  DateTime
  rate                         Decimal           @db.Decimal(8, 2)
  status                       BookingStatus     @default(PENDING)
  billable                     Boolean           @default(false)
  notes                        String?
  createdAt                    DateTime          @default(now())
  updatedAt                    DateTime          @updatedAt
  bookingGroupId               String?
  isParent                     Boolean           @default(true)
  legNumber                    Int               @default(1)
  parentBookingId              Int?
  baseRate                     Decimal?          @db.Decimal(8, 2)
  fscRate                      Decimal?          @db.Decimal(5, 2)
  rateType                     RateType          @default(FLAT_RATE)
  driverName                   String?
  phoneNumber                  String?
  trailerLength                Int?
  type                         BookingType       @default(POWER_ONLY)
  carrierEmail                 String?
  carrierReportTime            String?
  confirmationIpAddress        String?
  confirmationSentAt           DateTime?
  confirmationSentVia          String?
  confirmationSignature        String?
  confirmationSignedAt         DateTime?
  confirmationSignedBy         String?
  confirmationToken            String?           @unique
  signedPdfPath                String?
  origin                       String?
  destination                  String?
  estimatedMiles               Decimal?          @db.Decimal(6, 1)
  manifestNumber               String?
  arrivalTime                  String?
  departureTime                String?
  destinationAddress           String?
  destinationCity              String?
  destinationContact           String?
  destinationLatitude          Decimal?          @db.Decimal(10, 7)
  destinationLongitude         Decimal?          @db.Decimal(10, 7)
  destinationState             String?
  destinationTimeZone          String?
  destinationZipCode           String?
  originAddress                String?
  originCity                   String?
  originContact                String?
  originLatitude               Decimal?          @db.Decimal(10, 7)
  originLongitude              Decimal?          @db.Decimal(10, 7)
  originState                  String?
  originTimeZone               String?
  originZipCode                String?
  routeFrequency               String?
  routeName                    String?
  routeRunTime                 Int?
  routeStandardRate            Decimal?          @db.Decimal(8, 2)
  legArrivalTimes              String?
  legDepartureTimes            String?
  documentUploadToken          String?           @unique
  documentUploadTokenCreatedAt DateTime?
  documents                    BookingDocument[]
  lineItems                    BookingLineItem[]
  carrier                      Carrier?          @relation(fields: [carrierId], references: [id])
  parentBooking                Booking?          @relation("BookingLegs", fields: [parentBookingId], references: [id])
  childBookings                Booking[]         @relation("BookingLegs")
  route                        Route?            @relation(fields: [routeId], references: [id])
  invoice                      Invoice?

  @@map("bookings")
}

model BookingLineItem {
  id          Int      @id @default(autoincrement())
  bookingId   Int
  category    String
  description String
  amount      Decimal  @db.Decimal(8, 2)
  quantity    Int      @default(1)
  unitPrice   Decimal? @db.Decimal(8, 2)
  receiptPath String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   Int?
  booking     Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  creator     User?    @relation(fields: [createdBy], references: [id])

  @@map("booking_line_items")
}

model CarrierPreferredRoute {
  carrierId Int
  routeId   Int
  carrier   Carrier @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  route     Route   @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@id([carrierId, routeId])
  @@map("carrier_preferred_routes")
}

model CarrierDocument {
  id           Int      @id @default(autoincrement())
  carrierId    Int
  documentType String
  filename     String
  filePath     String
  uploadedAt   DateTime @default(now())
  carrier      Carrier  @relation(fields: [carrierId], references: [id], onDelete: Cascade)

  @@map("carrier_documents")
}

model CarrierDriver {
  id            Int      @id @default(autoincrement())
  carrierId     Int
  name          String
  phoneNumber   String?
  email         String?
  licenseNumber String?
  active        Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  number        String?

  // Extended driver information for dispatch
  externalDriverId      String? // External system ID
  licenseClass          String? // CDL class (A, B, C)
  licenseState          String?
  licenseExpiration     DateTime?
  endorsements          String? // Comma-separated: hazmat, tanker, doubles, etc.
  hazmatEndorsement     Boolean  @default(false) // Has valid hazmat endorsement
  medicalCardExpiration DateTime?
  dateOfHire            DateTime?
  dateOfBirth           DateTime?

  // Current status and location
  driverStatus        DriverStatus @default(AVAILABLE)
  currentTerminalCode String?
  currentLatitude     Decimal?     @db.Decimal(10, 7)
  currentLongitude    Decimal?     @db.Decimal(10, 7)
  lastStatusUpdate    DateTime?

  // Assigned location (from Locations list)
  locationId Int?

  // Hours of Service (HOS) tracking
  hosDriveTimeRemaining Int? // Minutes remaining
  hosDutyTimeRemaining  Int? // Minutes remaining
  hosCycleTimeRemaining Int? // Minutes remaining (70/8 or 60/7)
  hosLastUpdate         DateTime?
  hosViolations         Int       @default(0)

  // Performance and preferences
  rating           Decimal? @db.Decimal(3, 2) // e.g., 4.85
  preferredRoutes  String? // Comma-separated terminal codes
  homeTerminalCode String?
  teamDriverId     Int? // Preferred team partner

  // Workday integration fields
  workdayEmployeeId String?   // Workday employee ID
  workdayLastSync   DateTime? // Last sync timestamp
  workdayRateInfo   String?   @db.Text // JSON blob of rate info from Workday

  // Relations
  carrier        Carrier          @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  location       Location?        @relation(fields: [locationId], references: [id])
  assignedTrucks EquipmentTruck[]
  primaryTrips   LinehaulTrip[]   @relation("PrimaryDriver")
  teamTrips      LinehaulTrip[]   @relation("TeamDriver")
  tripPays       TripPay[]
  tripReports    DriverTripReport[]
  equipmentIssues EquipmentIssue[]
  moraleRatings  DriverMoraleRating[]
  cutPayRequests CutPayRequest[]
  payrollLineItems PayrollLineItem[] @relation("PayrollLineItems")

  @@index([carrierId])
  @@index([driverStatus])
  @@index([externalDriverId])
  @@index([locationId])
  @@index([workdayEmployeeId])
  @@map("carrier_drivers")
}

model BookingDocument {
  id           Int      @id @default(autoincrement())
  bookingId    Int
  documentType String
  filename     String
  filePath     String
  uploadedAt   DateTime @default(now())
  uploadedBy   String?
  notes        String?
  booking      Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@map("booking_documents")
}

model Invoice {
  id                    Int                 @id @default(autoincrement())
  bookingId             Int                 @unique
  invoiceNumber         String              @unique
  amount                Decimal             @db.Decimal(8, 2)
  status                InvoiceStatus       @default(PENDING)
  createdAt             DateTime            @default(now())
  paidAt                DateTime?
  baseAmount            Decimal             @default(0.00) @db.Decimal(8, 2)
  includesDocuments     Boolean             @default(true)
  lineItemsAmount       Decimal             @default(0.00) @db.Decimal(8, 2)
  notes                 String?
  sentToAPAt            DateTime?
  sentToAPBy            String?
  updatedAt             DateTime            @default(now()) @updatedAt
  carrierCity           String?
  carrierContactPerson  String?
  carrierEmail          String?
  carrierName           String?
  carrierPhone          String?
  carrierState          String?
  carrierStreetAddress1 String?
  carrierStreetAddress2 String?
  carrierZipCode        String?
  attachments           InvoiceAttachment[]
  booking               Booking             @relation(fields: [bookingId], references: [id])

  @@index([status])
  @@index([createdAt])
  @@map("invoices")
}

model InvoiceAttachment {
  id           Int      @id @default(autoincrement())
  invoiceId    Int
  documentType String
  documentId   Int?
  filename     String
  filePath     String
  fileSize     Int?
  mimeType     String?
  uploadedAt   DateTime @default(now())
  invoice      Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_attachments")
}

model Location {
  id                 Int      @id @default(autoincrement())
  code               String   @unique
  name               String?
  address            String?
  city               String?
  state              String?
  zipCode            String?
  contact            String?
  timeZone           String?
  latitude           Decimal? @db.Decimal(10, 7)
  longitude          Decimal? @db.Decimal(10, 7)
  active             Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  hours              String?
  phone              String?
  notes              String?
  isPhysicalTerminal Boolean  @default(false)
  isVirtualTerminal  Boolean  @default(false)

  // Relations
  drivers CarrierDriver[]

  @@map("locations")
}

model CarrierInvitation {
  id            Int                     @id @default(autoincrement())
  email         String
  token         String                  @unique
  status        CarrierInvitationStatus @default(PENDING)
  sentAt        DateTime                @default(now())
  expiresAt     DateTime
  registeredAt  DateTime?
  createdBy     Int?
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  createdByUser User?                   @relation(fields: [createdBy], references: [id])

  @@index([email])
  @@index([status])
  @@map("carrier_invitations")
}

model CarrierAgreement {
  id               Int      @id @default(autoincrement())
  carrierId        Int      @map("carrier_id")
  agreementVersion String   @map("agreement_version")
  agreementTitle   String   @map("agreement_title")
  signedAt         DateTime @default(now()) @map("signed_at")
  signedBy         String   @map("signed_by")
  signedByTitle    String   @map("signed_by_title")
  ipAddress        String   @map("ip_address")
  userAgent        String?  @map("user_agent")
  geolocation      String?
  username         String
  affidavitPdfPath String?  @map("affidavit_pdf_path")
  agreementPdfPath String?  @map("agreement_pdf_path")
  agreementHash    String?  @map("agreement_hash")
  createdAt        DateTime @default(now()) @map("created_at")
  carrier          Carrier  @relation(fields: [carrierId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@map("carrier_agreements")
}

enum UserRole {
  ADMIN
  DISPATCHER
  USER
  CARRIER
  YARD_MANAGER
  PAYROLL_ADMIN
  PAYROLL_CLERK
}

enum CarrierStatus {
  PENDING
  ACTIVE
  INACTIVE
  SUSPENDED
  NOT_ONBOARDED
  ONBOARDED
  REJECTED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum RateType {
  MILE
  MILE_FSC
  FLAT_RATE
}

enum BookingType {
  POWER_ONLY
  POWER_AND_TRAILER
}

enum InvoiceStatus {
  PENDING
  SENT_TO_AP
  PAID
  OVERDUE
  CANCELLED
}

enum CarrierInvitationStatus {
  PENDING
  REGISTERED
  EXPIRED
  CANCELLED
}

// ============================================
// DISPATCH & FLEET MANAGEMENT MODULE - ENUMS
// ============================================

enum EquipmentStatus {
  AVAILABLE
  DISPATCHED
  IN_TRANSIT
  MAINTENANCE
  OUT_OF_SERVICE
}

enum TruckType {
  DAY_CAB
  SLEEPER
  STRAIGHT_TRUCK
}

enum TrailerType {
  DRY_VAN_53
  DRY_VAN_28
  PUP_TRAILER
  REEFER_53
  REEFER_28
  FLATBED
  STEP_DECK
  TANKER
  INTERMODAL
}

enum DollyType {
  A_DOLLY
  B_DOLLY
}

enum TripStatus {
  PLANNED
  ASSIGNED
  DISPATCHED
  IN_TRANSIT
  ARRIVED
  UNLOADING
  COMPLETED
  CANCELLED
}

enum DelayCode {
  EQUIPMENT_BREAKDOWN
  DRIVER_UNAVAILABILITY
  WEATHER_CONDITIONS
  TRAFFIC_ROAD_CONDITIONS
  SHIPPER_DELAY
  RECEIVER_DELAY
  DETENTION
  OTHER
}

enum RateMethod {
  PER_MILE
  FLAT_RATE
  HOURLY
  PERCENTAGE
}

enum RateCardType {
  DRIVER
  CARRIER
  LINEHAUL
  OD_PAIR
  DEFAULT
}

enum AccessorialType {
  LAYOVER
  DETENTION
  BREAKDOWN
  HELPER
  TRAINER
  HAZMAT
  TEAM_DRIVER
  STOP_CHARGE
  FUEL_SURCHARGE
  DROP_HOOK
  DROP_HOOK_SINGLE
  DROP_HOOK_DOUBLE_TRIPLE
  CHAIN_UP
  WAIT_TIME
  SINGLE_TRAILER
  DOUBLE_TRAILER
  TRIPLE_TRAILER
  CUT_PAY
  CUT_PAY_SINGLE_MILES
  CUT_PAY_DOUBLE_MILES
  CUT_PAY_TRIPLE_MILES
  OTHER
}

enum CutPayStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

enum PayPeriodStatus {
  OPEN
  CLOSED
  LOCKED
  EXPORTED
}

enum TripPayStatus {
  PENDING
  CALCULATED
  REVIEWED
  APPROVED
  PAID
  DISPUTED
}

enum PayrollSourceType {
  TRIP_PAY
  CUT_PAY
}

enum PayrollLineItemStatus {
  PENDING
  CALCULATED
  REVIEWED
  APPROVED
  PAID
  DISPUTED
}

enum DriverStatus {
  AVAILABLE
  ON_DUTY
  DRIVING
  SLEEPER_BERTH
  OFF_DUTY
  PERSONAL_CONVEYANCE
  YARD_MOVE
}

// Trip Document Enums
enum TripDocumentType {
  LINEHAUL_MANIFEST
  PLACARD_SHEET
  HAZMAT_BOL
}

enum TripDocumentStatus {
  PENDING
  GENERATED
  ERROR
}

// ============================================
// DISPATCH & FLEET MANAGEMENT MODULE - MODELS
// ============================================

// Terminal/Yard Locations
model Terminal {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  name      String
  address   String?
  city      String?
  state     String?
  zipCode   String?
  timezone  String?
  latitude  Decimal? @db.Decimal(10, 7)
  longitude Decimal? @db.Decimal(10, 7)
  phone     String?
  contact   String?
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  trucks                 EquipmentTruck[]
  trailers               EquipmentTrailer[]
  dollies                EquipmentDolly[]
  equipmentRequirements  TerminalEquipmentRequirement[]
  originLinehaulProfiles LinehaulProfile[]              @relation("OriginTerminal")
  destLinehaulProfiles   LinehaulProfile[]              @relation("DestinationTerminal")
  originRateCards        RateCard[]                     @relation("RateCardOrigin")
  destRateCards          RateCard[]                     @relation("RateCardDestination")
  loadsheets                       Loadsheet[]
  okayToLoadProfiles               ProfileOkayToLoad[]            @relation("OkayToLoadProfiles")
  okayToDispatchProfiles           ProfileOkayToDispatch[]        @relation("OkayToDispatchProfiles")
  accountableLateDepartureReasons  LateDepartureReason[]

  @@map("terminals")
}

// Power Units (Tractors/Trucks)
model EquipmentTruck {
  id                  Int             @id @default(autoincrement())
  unitNumber          String          @unique
  truckType           TruckType       @default(DAY_CAB)
  make                String?
  model               String?
  year                Int?
  vin                 String?
  currentTerminalId   Int?
  status              EquipmentStatus @default(AVAILABLE)
  assignedDriverId    Int?
  lastLocationUpdate  DateTime?
  maintenanceStatus   String?
  maintenanceNotes    String?
  nextMaintenanceDate DateTime?
  externalFleetId     String?
  owned               Boolean         @default(true)
  leaseExpiration     DateTime?
  licensePlate        String?
  licensePlateState   String?
  fuelType            String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  // Relations
  currentTerminal Terminal?      @relation(fields: [currentTerminalId], references: [id])
  assignedDriver  CarrierDriver? @relation(fields: [assignedDriverId], references: [id])
  linehaulTrips   LinehaulTrip[]

  @@index([currentTerminalId])
  @@index([status])
  @@index([assignedDriverId])
  @@map("equipment_trucks")
}

// Trailers
model EquipmentTrailer {
  id                 Int             @id @default(autoincrement())
  unitNumber         String          @unique
  trailerType        TrailerType     @default(DRY_VAN_53)
  lengthFeet         Int?
  capacityWeight     Int?
  capacityCube       Int?
  currentTerminalId  Int?
  status             EquipmentStatus @default(AVAILABLE)
  currentLocation    String?
  externalFleetId    String?
  owned              Boolean         @default(true)
  leaseExpiration    DateTime?
  licensePlate       String?
  licensePlateState  String?
  lastInspectionDate DateTime?
  nextInspectionDate DateTime?
  maintenanceStatus  String?
  maintenanceNotes   String?
  pintleHook         Boolean         @default(false)
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt

  // Relations
  currentTerminal Terminal?      @relation(fields: [currentTerminalId], references: [id])
  primaryTrips    LinehaulTrip[] @relation("PrimaryTrailer")
  secondaryTrips  LinehaulTrip[] @relation("SecondaryTrailer")
  tertiaryTrips   LinehaulTrip[] @relation("TertiaryTrailer")

  @@index([currentTerminalId])
  @@index([status])
  @@index([trailerType])
  @@map("equipment_trailers")
}

// Converter Dollies
model EquipmentDolly {
  id                 Int             @id @default(autoincrement())
  unitNumber         String          @unique
  dollyType          DollyType       @default(A_DOLLY)
  currentTerminalId  Int?
  status             EquipmentStatus @default(AVAILABLE)
  externalFleetId    String?
  lastInspectionDate DateTime?
  nextInspectionDate DateTime?
  maintenanceStatus  String?
  maintenanceNotes   String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt

  // Relations
  currentTerminal  Terminal?      @relation(fields: [currentTerminalId], references: [id])
  linehaulTrips    LinehaulTrip[] @relation("PrimaryDolly")
  linehaulTrips2   LinehaulTrip[] @relation("SecondaryDolly")

  @@index([currentTerminalId])
  @@index([status])
  @@map("equipment_dollies")
}

// Terminal Equipment Requirements
model TerminalEquipmentRequirement {
  id             Int       @id @default(autoincrement())
  terminalId     Int
  equipmentType  String // truck, trailer_53, trailer_28, dolly_a, dolly_b, etc.
  minCount       Int       @default(0)
  maxCount       Int?
  dayOfWeek      Int? // 0-6, null for all days
  effectiveDate  DateTime?
  expirationDate DateTime?
  seasonalNote   String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  terminal Terminal @relation(fields: [terminalId], references: [id], onDelete: Cascade)

  @@index([terminalId])
  @@index([equipmentType])
  @@map("terminal_equipment_requirements")
}

// Linehaul Profiles (Standard Routes)
model LinehaulProfile {
  id                    Int      @id @default(autoincrement())
  profileCode           String   @unique
  name                  String
  originTerminalId      Int
  destinationTerminalId Int
  standardDepartureTime String? // Time in HH:MM format
  standardArrivalTime   String? // Time in HH:MM format
  distanceMiles         Int?
  transitTimeMinutes    Int?
  frequency             String? // daily, mon-fri, specific days, on-demand
  equipmentConfig       String? // tractor-trailer, tractor-pup-dolly-pup, etc.
  requiresTeamDriver    Boolean  @default(false)
  hazmatRequired        Boolean  @default(false)
  active                Boolean  @default(true)
  notes                 String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Relations
  originTerminal          Terminal                @relation("OriginTerminal", fields: [originTerminalId], references: [id])
  destinationTerminal     Terminal                @relation("DestinationTerminal", fields: [destinationTerminalId], references: [id])
  trips                   LinehaulTrip[]
  rateCards               RateCard[]
  okayToLoadTerminals     ProfileOkayToLoad[]     @relation("OkayToLoadTerminals")
  okayToDispatchTerminals ProfileOkayToDispatch[] @relation("OkayToDispatchTerminals")

  @@index([originTerminalId])
  @@index([destinationTerminalId])
  @@index([active])
  @@map("linehaul_profiles")
}

// Linehaul Trips (Actual Dispatches)
model LinehaulTrip {
  id                Int        @id @default(autoincrement())
  tripNumber        String     @unique
  linehaulProfileId Int?
  dispatchDate      DateTime
  plannedDeparture  DateTime?
  actualDeparture   DateTime?
  plannedArrival    DateTime?
  actualArrival     DateTime?
  status            TripStatus @default(PLANNED)

  // Driver assignment (can be internal driver or external carrier driver)
  driverId         Int?
  driverExternalId String? // For external driver system
  teamDriverId     Int? // Second driver for team

  // Equipment assignment
  truckId    Int?
  trailerId  Int?
  dollyId    Int?
  trailer2Id Int? // For double/triple configs
  dolly2Id   Int? // Second dolly for triple configs
  trailer3Id Int? // Third trailer for triple configs

  // Load details
  totalWeight     Int?
  totalPieces     Int?
  shipmentCount   Int?
  cubeUtilization Decimal? @db.Decimal(5, 2) // Percentage

  // Origin/Destination (can override profile)
  originTerminalCode      String?
  destinationTerminalCode String?
  actualMileage           Int?

  // Notes and instructions
  notes               String?
  specialInstructions String?

  // Tracking
  lastKnownLatitude  Decimal?  @db.Decimal(10, 7)
  lastKnownLongitude Decimal?  @db.Decimal(10, 7)
  lastLocationUpdate DateTime?
  estimatedArrival   DateTime?

  // Audit
  createdBy    Int?
  dispatchedBy Int?
  dispatchedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  linehaulProfile  LinehaulProfile?  @relation(fields: [linehaulProfileId], references: [id])
  driver           CarrierDriver?    @relation("PrimaryDriver", fields: [driverId], references: [id])
  teamDriver       CarrierDriver?    @relation("TeamDriver", fields: [teamDriverId], references: [id])
  truck            EquipmentTruck?   @relation(fields: [truckId], references: [id])
  trailer          EquipmentTrailer? @relation("PrimaryTrailer", fields: [trailerId], references: [id])
  dolly            EquipmentDolly?   @relation("PrimaryDolly", fields: [dollyId], references: [id])
  trailer2         EquipmentTrailer? @relation("SecondaryTrailer", fields: [trailer2Id], references: [id])
  dolly2           EquipmentDolly?   @relation("SecondaryDolly", fields: [dolly2Id], references: [id])
  trailer3         EquipmentTrailer? @relation("TertiaryTrailer", fields: [trailer3Id], references: [id])
  createdByUser    User?             @relation("TripCreator", fields: [createdBy], references: [id])
  dispatchedByUser User?             @relation("TripDispatcher", fields: [dispatchedBy], references: [id])
  shipments           TripShipment[]
  delays              TripDelay[]
  tripPay             TripPay[]
  loadsheets          Loadsheet[]
  tripDocuments       TripDocument[]
  lateDepartureReason LateDepartureReason?
  driverTripReport    DriverTripReport?
  equipmentIssues     EquipmentIssue[]
  moraleRating        DriverMoraleRating?
  cutPayRequests      CutPayRequest[]
  payrollLineItems    PayrollLineItem[] @relation("PayrollLineItems")

  @@index([dispatchDate])
  @@index([status])
  @@index([driverId])
  @@index([linehaulProfileId])
  @@map("linehaul_trips")
}

// Trip Shipments (Load Manifest)
model TripShipment {
  id                  Int       @id @default(autoincrement())
  tripId              Int
  proNumber           String
  originTerminal      String?
  destinationTerminal String?
  weight              Int?
  pieces              Int?
  handlingUnits       Int?
  serviceLevel        String? // standard, guaranteed, expedited
  specialInstructions String?
  hazmat              Boolean   @default(false)
  hazmatClass         String?
  externalShipmentId  String?
  loadedAt            DateTime?
  createdAt           DateTime  @default(now())

  // Relations
  trip LinehaulTrip @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@index([tripId])
  @@index([proNumber])
  @@map("trip_shipments")
}

// Trip Delays
model TripDelay {
  id               Int       @id @default(autoincrement())
  tripId           Int
  delayCode        DelayCode
  delayReason      String?
  delayMinutes     Int
  reportedAt       DateTime  @default(now())
  reportedBy       Int?
  affectsShipments Boolean   @default(true)
  resolvedAt       DateTime?
  resolutionNotes  String?
  createdAt        DateTime  @default(now())

  // Relations
  trip     LinehaulTrip @relation(fields: [tripId], references: [id], onDelete: Cascade)
  reporter User?        @relation(fields: [reportedBy], references: [id])

  @@index([tripId])
  @@index([delayCode])
  @@map("trip_delays")
}

// Rate Cards
model RateCard {
  id                    Int          @id @default(autoincrement())
  rateType              RateCardType
  entityId              Int? // References driver_id, carrier_id, linehaul_profile_id based on rateType
  originTerminalId      Int?
  destinationTerminalId Int?
  linehaulProfileId     Int?
  rateMethod            RateMethod   @default(PER_MILE)
  rateAmount            Decimal      @db.Decimal(8, 2)
  minimumAmount         Decimal?     @db.Decimal(8, 2)
  maximumAmount         Decimal?     @db.Decimal(8, 2)
  effectiveDate         DateTime
  expirationDate        DateTime?
  equipmentType         String?
  priority              Int          @default(5) // Lower = higher priority
  externalRateId        String?
  notes                 String?
  active                Boolean      @default(true)
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt

  // Relations
  originTerminal      Terminal?         @relation("RateCardOrigin", fields: [originTerminalId], references: [id])
  destinationTerminal Terminal?         @relation("RateCardDestination", fields: [destinationTerminalId], references: [id])
  linehaulProfile     LinehaulProfile?  @relation(fields: [linehaulProfileId], references: [id])
  accessorialRates    AccessorialRate[]
  tripPays            TripPay[]

  @@index([rateType])
  @@index([entityId])
  @@index([effectiveDate])
  @@index([active])
  @@map("rate_cards")
}

// Accessorial Rates
model AccessorialRate {
  id              Int             @id @default(autoincrement())
  rateCardId      Int
  accessorialType AccessorialType
  rateAmount      Decimal         @db.Decimal(8, 2)
  rateMethod      RateMethod      @default(FLAT_RATE)
  minimumCharge   Decimal?        @db.Decimal(8, 2)
  maximumCharge   Decimal?        @db.Decimal(8, 2)
  description     String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  rateCard RateCard @relation(fields: [rateCardId], references: [id], onDelete: Cascade)

  @@index([rateCardId])
  @@index([accessorialType])
  @@map("accessorial_rates")
}

// Pay Periods
model PayPeriod {
  id            Int             @id @default(autoincrement())
  periodStart   DateTime
  periodEnd     DateTime
  status        PayPeriodStatus @default(OPEN)
  closedAt      DateTime?
  closedBy      Int?
  exportedAt    DateTime?
  exportedBy    Int?
  exportBatchId String?
  notes         String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  // Relations
  closedByUser     User?             @relation("PayPeriodCloser", fields: [closedBy], references: [id])
  exportedByUser   User?             @relation("PayPeriodExporter", fields: [exportedBy], references: [id])
  tripPays         TripPay[]
  payrollLineItems PayrollLineItem[]

  @@index([periodStart])
  @@index([periodEnd])
  @@index([status])
  @@map("pay_periods")
}

// Trip Pay Records
model TripPay {
  id               Int     @id @default(autoincrement())
  tripId           Int
  payPeriodId      Int?
  driverId         Int?
  driverExternalId String?
  rateCardId       Int?

  // Pay breakdown
  basePay        Decimal? @db.Decimal(8, 2)
  mileagePay     Decimal? @db.Decimal(8, 2)
  accessorialPay Decimal? @db.Decimal(8, 2)
  bonusPay       Decimal? @db.Decimal(8, 2)
  deductions     Decimal? @db.Decimal(8, 2)
  totalGrossPay  Decimal? @db.Decimal(8, 2)

  // For team/split pay
  splitPercentage Decimal? @db.Decimal(5, 2) // e.g., 50.00 for 50%
  splitType       String? // primary, team, trainer, trainee

  // Status tracking
  status       TripPayStatus @default(PENDING)
  calculatedAt DateTime?
  reviewedBy   Int?
  reviewedAt   DateTime?
  approvedBy   Int?
  approvedAt   DateTime?
  paidAt       DateTime?

  // Payroll export
  externalPayrollId String?
  exportedAt        DateTime?

  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  trip            LinehaulTrip     @relation(fields: [tripId], references: [id], onDelete: Cascade)
  payPeriod       PayPeriod?       @relation(fields: [payPeriodId], references: [id])
  driver          CarrierDriver?   @relation(fields: [driverId], references: [id])
  rateCard        RateCard?        @relation(fields: [rateCardId], references: [id])
  reviewer        User?            @relation("TripPayReviewer", fields: [reviewedBy], references: [id])
  approver        User?            @relation("TripPayApprover", fields: [approvedBy], references: [id])
  payrollLineItem PayrollLineItem?

  @@index([tripId])
  @@index([payPeriodId])
  @@index([driverId])
  @@index([status])
  @@map("trip_pay")
}

// Unified Payroll Line Items - stores all payroll entries (trip pay + cut pay)
model PayrollLineItem {
  id                Int                   @id @default(autoincrement())

  // Source tracking
  sourceType        PayrollSourceType
  tripPayId         Int?                  @unique // Reference to TripPay if source is TRIP_PAY
  cutPayRequestId   Int?                  @unique // Reference to CutPayRequest if source is CUT_PAY

  // Core fields
  driverId          Int
  tripId            Int?                  // LinehaulTrip reference (for trip pay or cut pay linked to trip)
  payPeriodId       Int?
  date              DateTime              // Dispatch date for trips, request date for cut pay

  // Driver info (denormalized for reporting)
  driverName        String?
  driverNumber      String?
  workdayEmployeeId String?

  // Trip info (for trip pay)
  tripNumber        String?
  origin            String?               // Origin terminal code
  destination       String?               // Destination terminal code
  totalMiles        Decimal?              @db.Decimal(8, 1)

  // Pay breakdown
  basePay           Decimal               @default(0) @db.Decimal(10, 2)
  mileagePay        Decimal               @default(0) @db.Decimal(10, 2)

  // Accessorial breakdown
  dropAndHookPay    Decimal               @default(0) @db.Decimal(10, 2)
  chainUpPay        Decimal               @default(0) @db.Decimal(10, 2)
  waitTimePay       Decimal               @default(0) @db.Decimal(10, 2)
  otherAccessorialPay Decimal             @default(0) @db.Decimal(10, 2)

  // Additional pay
  bonusPay          Decimal               @default(0) @db.Decimal(10, 2)
  deductions        Decimal               @default(0) @db.Decimal(10, 2)
  totalGrossPay     Decimal               @default(0) @db.Decimal(10, 2)

  // Cut pay specific fields
  cutPayType        CutPayType?           // HOURS or MILES
  cutPayHours       Decimal?              @db.Decimal(6, 2)
  cutPayMiles       Decimal?              @db.Decimal(8, 1)
  trailerConfig     String?               // SINGLE, DOUBLE, TRIPLE
  rateApplied       Decimal?              @db.Decimal(10, 4)

  // Status tracking
  status            PayrollLineItemStatus @default(PENDING)
  calculatedAt      DateTime?
  reviewedBy        Int?
  reviewedAt        DateTime?
  approvedBy        Int?
  approvedAt        DateTime?
  paidAt            DateTime?

  // Payroll export
  externalPayrollId String?
  exportedAt        DateTime?

  notes             String?
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  // Relations
  driver            CarrierDriver         @relation("PayrollLineItems", fields: [driverId], references: [id])
  trip              LinehaulTrip?         @relation("PayrollLineItems", fields: [tripId], references: [id])
  payPeriod         PayPeriod?            @relation(fields: [payPeriodId], references: [id])
  tripPay           TripPay?              @relation(fields: [tripPayId], references: [id])
  cutPayRequest     CutPayRequest?        @relation(fields: [cutPayRequestId], references: [id])
  reviewer          User?                 @relation("PayrollLineItemReviewer", fields: [reviewedBy], references: [id])
  approver          User?                 @relation("PayrollLineItemApprover", fields: [approvedBy], references: [id])

  @@index([sourceType])
  @@index([driverId])
  @@index([tripId])
  @@index([payPeriodId])
  @@index([date])
  @@index([status])
  @@map("payroll_line_items")
}

// ============================================
// LOADSHEET MODULE - ENUMS & MODELS
// ============================================

enum LoadsheetStatus {
  DRAFT
  OPEN
  LOADING
  CLOSED
  DISPATCHED
}

enum LoadType {
  PURE
  MIX
}

// Loadsheet (Manifest Document)
model Loadsheet {
  id                      Int             @id @default(autoincrement())
  manifestNumber          String          @unique

  // Header Section
  trailerNumber           String
  suggestedTrailerLength  Int?            @default(53)
  pintleHookRequired      Boolean         @default(false)
  targetDispatchTime      String?         // Time in HH:MM format
  scheduledDepartDate     String?         // Date in YYYY-MM-DD format
  linehaulName            String          // e.g., "ABQELP2"
  preloadManifest         String?
  originTerminalId        Int?
  originTerminalCode      String?         // e.g., "ABQ"
  destinationTerminalCode String?         // e.g., "ELP" - destination for this leg
  routeId                 Int?            // Reference to specific route/leg for multi-leg profiles
  linehaulTripId          Int?
  doorNumber              String?         // Loading door location for scanners

  // Loading Info Section
  loadDate                DateTime        @default(now())
  straps                  Int?
  closeTime               String?         // Time in HH:MM format
  loadType                LoadType        @default(PURE)
  loadbars                Int?
  loaderNumber            String?
  exceptions              String?
  capacity                String?         // "0%", "25%", "50%", "75%", "100%"
  blankets                Int?
  loaderName              String?
  sealNumber              String?
  pieces                  Int?            // Total pieces loaded
  weight                  Int?            // Total weight in lbs

  // Trailer Condition
  wallCondition           String          @default("OK")  // "OK" or "REPAIR"
  floorCondition          String          @default("OK")
  roofCondition           String          @default("OK")
  trailerConditionComment String?

  // HAZMAT Placards (stored as JSON array)
  hazmatPlacards          String?         // JSON: ["CORROSIVE", "FLAMMABLE", etc.]

  // Status and Audit
  status                  LoadsheetStatus @default(DRAFT)
  createdBy               Int?
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
  printedAt               DateTime?
  lastScanAt              DateTime?       // Last LHLOAD barcode scan timestamp

  // Relations
  originTerminal          Terminal?       @relation(fields: [originTerminalId], references: [id])
  route                   Route?          @relation(fields: [routeId], references: [id])
  linehaulTrip            LinehaulTrip?   @relation(fields: [linehaulTripId], references: [id])
  hazmatItems             LoadsheetHazmatItem[]
  dispatchEntries         LoadsheetDispatchEntry[]
  freightPlacements       LoadsheetFreightPlacement[]

  @@index([manifestNumber])
  @@index([status])
  @@index([loadDate])
  @@index([linehaulTripId])
  @@index([routeId])
  @@index([linehaulName, originTerminalCode])
  @@map("loadsheets")
}

// Loadsheet Hazmat Items (HM1-HM10)
model LoadsheetHazmatItem {
  id          Int       @id @default(autoincrement())
  loadsheetId Int
  itemNumber  Int       // 1-10 (HM1-HM10)
  proNumber   String?
  hazmatClass String?
  weight      Int?
  createdAt   DateTime  @default(now())

  loadsheet   Loadsheet @relation(fields: [loadsheetId], references: [id], onDelete: Cascade)

  @@index([loadsheetId])
  @@map("loadsheet_hazmat_items")
}

// Loadsheet Dispatch Entries (grid on right side)
model LoadsheetDispatchEntry {
  id               Int       @id @default(autoincrement())
  loadsheetId      Int
  rowNumber        Int       // Order in the grid
  dispatchTime     String?   // Time in HH:MM AM/PM format
  dispatchTerminal String?   // Terminal code
  nextTerminal     String?   // Next destination terminal code
  tractorNumber    String?
  driverNumber     String?
  driverName       String?
  supervisorNumber String?
  createdAt        DateTime  @default(now())

  loadsheet        Loadsheet @relation(fields: [loadsheetId], references: [id], onDelete: Cascade)

  @@index([loadsheetId])
  @@map("loadsheet_dispatch_entries")
}

// Loadsheet Freight Placement (Trailer Diagram)
model LoadsheetFreightPlacement {
  id          Int       @id @default(autoincrement())
  loadsheetId Int
  rowNumber   Int       // Grid row position
  loose       String?   // Freight description for loose column
  left        String?   // Freight description for left side
  right       String?   // Freight description for right side
  createdAt   DateTime  @default(now())

  loadsheet   Loadsheet @relation(fields: [loadsheetId], references: [id], onDelete: Cascade)

  @@index([loadsheetId])
  @@map("loadsheet_freight_placements")
}

// ============================================
// LATE DEPARTURE REASON MODULE
// ============================================

enum LateReasonType {
  PRE_LOAD
  DOCK_ISSUE
  STAFFING
  DRIVER_ISSUE
  WEATHER
  LATE_INBOUND
  DISPATCH_ISSUE
}

enum WaitTimeReason {
  LATE_MEET_DRIVER
  DOCK_DELAY
  BREAKDOWN
}

enum EquipmentIssueType {
  TRAILER
  DOLLY
}

// Late Departure Reason - tracks late departures for trips
model LateDepartureReason {
  id                      Int             @id @default(autoincrement())
  tripId                  Int             @unique // One late reason per trip
  reason                  LateReasonType
  willCauseServiceFailure Boolean
  accountableTerminalId   Int?            // Optional when service failure is No
  accountableTerminalCode String?         // Stored for historical reference
  notes                   String?
  scheduledDepartTime     String?         // Original scheduled time (HH:mm)
  actualDepartTime        String?         // Actual departure time (HH:mm)
  minutesLate             Int?            // Calculated minutes late
  createdBy               Int?
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt

  // Relations
  trip                LinehaulTrip @relation(fields: [tripId], references: [id], onDelete: Cascade)
  accountableTerminal Terminal?    @relation(fields: [accountableTerminalId], references: [id])
  creator             User?        @relation(fields: [createdBy], references: [id])

  @@index([tripId])
  @@index([reason])
  @@index([accountableTerminalId])
  @@index([createdAt])
  @@map("late_departure_reasons")
}

// ============================================
// TRIP DOCUMENT MODULE - MODELS
// ============================================

// Trip Document (metadata for generated documents)
model TripDocument {
  id             Int                @id @default(autoincrement())
  tripId         Int
  documentType   TripDocumentType
  documentNumber String             @unique
  status         TripDocumentStatus @default(PENDING)
  documentData   String?            @db.Text // Cached JSON data for regeneration
  generatedAt    DateTime?
  errorMessage   String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  // Relations
  trip         LinehaulTrip          @relation(fields: [tripId], references: [id], onDelete: Cascade)
  manifestData ManifestDocumentData?
  placardData  PlacardSheetData?

  @@index([tripId])
  @@index([documentType])
  @@index([status])
  @@map("trip_documents")
}

// Manifest Document Data (Linehaul Manifest specific data)
model ManifestDocumentData {
  id                  Int       @id @default(autoincrement())
  tripDocumentId      Int       @unique
  tripDisplay         String    // e.g., "5760U - DEN to GJT - TRIP 2854318"
  manifestNumber      String
  driverName          String?
  trailerNumber       String?
  originCode          String
  destCode            String
  effort              String?   // e.g., "1 hr 18 min"
  timeDue             String?
  lastLoad            String?
  totalScans          Int       @default(0)
  totalPieces         Int       @default(0)
  totalWeight         Int       @default(0)
  dispatchedAt        DateTime?
  arrivedAt           DateTime?
  createdAt           DateTime  @default(now())

  // Relations
  tripDocument TripDocument          @relation(fields: [tripDocumentId], references: [id], onDelete: Cascade)
  freightItems ManifestFreightItem[]

  @@map("manifest_document_data")
}

// Manifest Freight Items (the table rows in linehaul manifest)
model ManifestFreightItem {
  id                 Int       @id @default(autoincrement())
  manifestDataId     Int
  proNumber          String
  manifestNumber     String?   // The loadsheet manifest number this shipment was scanned/loaded to
  destTerminal       String?
  destTerminalSub    String?   // Sub-terminal (e.g., "SOUTH2", "NORTH2")
  scans              Int       @default(1)
  pieces             Int       @default(0)
  weight             Int       @default(0)
  consigneeName      String?
  consigneeCity      String?
  shipperName        String?
  shipperCity        String?
  expDeliveryDate    DateTime?
  loadedTerminal     String?
  unloadedTerminal   String?
  isHazmat           Boolean   @default(false)
  hazmatClass        String?
  sortOrder          Int       @default(0)
  createdAt          DateTime  @default(now())

  // Relations
  manifestData ManifestDocumentData @relation(fields: [manifestDataId], references: [id], onDelete: Cascade)

  @@index([manifestDataId])
  @@map("manifest_freight_items")
}

// Placard Sheet Data (Hazmat placard information)
model PlacardSheetData {
  id             Int      @id @default(autoincrement())
  tripDocumentId Int      @unique
  tripDisplay    String
  trailerNumber  String?
  createdAt      DateTime @default(now())

  // Relations
  tripDocument     TripDocument      @relation(fields: [tripDocumentId], references: [id], onDelete: Cascade)
  hazmatItems      PlacardHazmatItem[]
  requiredPlacards RequiredPlacard[]

  @@map("placard_sheet_data")
}

// Placard Hazmat Items (individual hazmat items on placard sheet)
model PlacardHazmatItem {
  id            Int      @id @default(autoincrement())
  placardDataId Int
  proNumber     String
  unNumber      String   // UN number (e.g., "UN2794")
  hazardClass   String   // Class (e.g., "8")
  packingGroup  String?  // PG (I, II, III)
  weight        Int?
  isBulk        Boolean  @default(false)
  isLimitedQty  Boolean  @default(false)
  shippingName  String
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())

  // Relations
  placardData PlacardSheetData @relation(fields: [placardDataId], references: [id], onDelete: Cascade)

  @@index([placardDataId])
  @@map("placard_hazmat_items")
}

// Required Placards (visual placards to display)
model RequiredPlacard {
  id            Int      @id @default(autoincrement())
  placardDataId Int
  placardClass  String   // "8", "3", "2.1", etc.
  placardLabel  String   // "CORROSIVE", "FLAMMABLE", etc.
  createdAt     DateTime @default(now())

  // Relations
  placardData PlacardSheetData @relation(fields: [placardDataId], references: [id], onDelete: Cascade)

  @@index([placardDataId])
  @@map("required_placards")
}

// Okay to Load - Terminals where freight for these destinations can be loaded from profile's origin
model ProfileOkayToLoad {
  linehaulProfileId Int
  terminalId        Int
  createdAt         DateTime @default(now())

  linehaulProfile LinehaulProfile @relation("OkayToLoadTerminals", fields: [linehaulProfileId], references: [id], onDelete: Cascade)
  terminal        Terminal        @relation("OkayToLoadProfiles", fields: [terminalId], references: [id], onDelete: Cascade)

  @@id([linehaulProfileId, terminalId])
  @@index([terminalId])
  @@map("profile_okay_to_load")
}

// Okay to Dispatch - Acceptable dispatch destinations from profile's origin
model ProfileOkayToDispatch {
  linehaulProfileId Int
  terminalId        Int
  createdAt         DateTime @default(now())

  linehaulProfile LinehaulProfile @relation("OkayToDispatchTerminals", fields: [linehaulProfileId], references: [id], onDelete: Cascade)
  terminal        Terminal        @relation("OkayToDispatchProfiles", fields: [terminalId], references: [id], onDelete: Cascade)

  @@id([linehaulProfileId, terminalId])
  @@index([terminalId])
  @@map("profile_okay_to_dispatch")
}

// ============================================
// DRIVER TRIP REPORT MODULE - For pay verification
// ============================================

// Driver Trip Report - stores driver-submitted arrival information for pay verification
model DriverTripReport {
  id        Int @id @default(autoincrement())
  tripId    Int @unique
  driverId  Int?

  // Operational details
  dropAndHook   Int?
  chainUpCycles Int?

  // Wait time tracking
  waitTimeStart   DateTime?
  waitTimeEnd     DateTime?
  waitTimeMinutes Int?            // Calculated from start/end
  waitTimeReason  WaitTimeReason?
  notes           String?

  // Pay verification workflow
  verified        Boolean   @default(false)
  verifiedBy      Int?
  verifiedAt      DateTime?
  payApproved     Boolean   @default(false)
  payApprovedBy   Int?
  payApprovedAt   DateTime?

  // Timestamps
  arrivedAt DateTime  @default(now())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  trip        LinehaulTrip   @relation(fields: [tripId], references: [id], onDelete: Cascade)
  driver      CarrierDriver? @relation(fields: [driverId], references: [id])
  verifier    User?          @relation("ReportVerifier", fields: [verifiedBy], references: [id])
  payApprover User?          @relation("PayApprover", fields: [payApprovedBy], references: [id])

  @@index([tripId])
  @@index([driverId])
  @@index([verified])
  @@index([payApproved])
  @@index([arrivedAt])
  @@map("driver_trip_reports")
}

// Equipment Issue - tracks equipment issues reported by OWNOP drivers at arrival
model EquipmentIssue {
  id              Int                @id @default(autoincrement())
  tripId          Int
  driverId        Int?
  equipmentType   EquipmentIssueType // TRAILER or DOLLY
  equipmentNumber String
  description     String
  reportedAt      DateTime           @default(now())
  resolvedAt      DateTime?
  resolvedBy      Int?
  resolutionNotes String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  // Relations
  trip     LinehaulTrip   @relation(fields: [tripId], references: [id], onDelete: Cascade)
  driver   CarrierDriver? @relation(fields: [driverId], references: [id])
  resolver User?          @relation("IssueResolver", fields: [resolvedBy], references: [id])

  @@index([tripId])
  @@index([equipmentType])
  @@index([resolvedAt])
  @@map("equipment_issues")
}

// Driver Morale Rating - tracks driver morale ratings at arrival (second arrival in 24 hours)
model DriverMoraleRating {
  id        Int      @id @default(autoincrement())
  tripId    Int      @unique
  driverId  Int
  rating    Int      // 1-5 star rating (1=Poor, 5=Very Good)
  arrivedAt DateTime @default(now())
  createdAt DateTime @default(now())

  // Relations
  trip   LinehaulTrip  @relation(fields: [tripId], references: [id], onDelete: Cascade)
  driver CarrierDriver @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@index([driverId])
  @@index([arrivedAt])
  @@index([rating])
  @@map("driver_morale_ratings")
}

// ============================================
// CUT PAY REQUEST MODULE
// ============================================

// Cut Pay Type - determines if cut pay is calculated by hours or miles
enum CutPayType {
  HOURS
  MILES
}

// Cut Pay Request - tracks when drivers are cut (not working due to low freight)
model CutPayRequest {
  id              Int          @id @default(autoincrement())
  driverId        Int
  requestDate     DateTime     @default(now())
  tripId          Int?         // Optional reference to planned/cancelled trip
  status          CutPayStatus @default(PENDING)
  trailerConfig   String?      // SINGLE, DOUBLE, TRIPLE
  cutPayType      CutPayType   @default(HOURS) // HOURS or MILES
  hoursRequested  Decimal?     @db.Decimal(4, 2) // Hours cut (when cutPayType is HOURS)
  milesRequested  Decimal?     @db.Decimal(6, 1) // Miles cut (when cutPayType is MILES)
  reason          String?
  approvedBy      Int?
  approvedAt      DateTime?
  rateApplied     Decimal?     @db.Decimal(8, 2)
  totalPay        Decimal?     @db.Decimal(8, 2)
  notes           String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  // Relations
  driver          CarrierDriver    @relation(fields: [driverId], references: [id])
  trip            LinehaulTrip?    @relation(fields: [tripId], references: [id])
  approver        User?            @relation("CutPayApprover", fields: [approvedBy], references: [id])
  payrollLineItem PayrollLineItem?

  @@index([driverId])
  @@index([status])
  @@index([requestDate])
  @@map("cut_pay_requests")
}

// ============================================
// WORKDAY INTEGRATION MODULE
// ============================================

// Workday Paycode Configuration - maps internal pay types to Workday paycodes
model WorkdayPaycode {
  id            Int      @id @default(autoincrement())
  code          String   @unique // e.g., "LH_SINGLE_MILES"
  workdayId     String   // Workday ID like "252c7e64604d1000ad393115c9fd0000"
  description   String
  payType       String   // MILES, DROP_HOOK, CHAIN_UP, STOP_HOURS, TRIP_PAY, CUT_PAY, CUT_MILES
  trailerConfig String?  // SINGLE, DOUBLE, TRIPLE, or null for generic
  isCutPay      Boolean  @default(false)
  active        Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([payType])
  @@index([trailerConfig])
  @@map("workday_paycodes")
}
